<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cycle</title>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            background-color: #333;
            /* Dark gray background */
        }

        #lane-container {
            display: flex;
            align-items: center;
        }

        .lane {
            /* margin: 0 20px; */
            /* Adjust the margin as needed */
            color: white;
            /* Text color for better visibility on dark background */
            text-align: center;
            position: relative;
            padding: 0 30px;
        }

        .lane img {
            width: 100%;
            height: auto;
            display: block;
            margin: auto;
        }

        .dropdown {
            margin-top: 10px;
            text-align: center;
        }

        .lane-number {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
        }

        #controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            text-align: right;
        }

        /* Style for the toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 34px;
            transition: .4s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        input:checked+.toggle-slider {
            background-color: #2196F3;
        }

        input:focus+.toggle-slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body>
    <div id="lane-container">
        <div class="lane" id="lane1">
            <img src="images/off.png" alt="Cycling Image">
            <div class="dropdown">
                <select onchange="changeFunction(this.value, 'lane1')">
                    <option value="off" selected>Off</option>
                    <option value="unknown">Unknown</option>
                    <option value="unknown2">Unknown</option>
                    <option value="operational">Operational</option>
                    <option value="yellowblinking">Yellow Blinking</option>
                </select>
            </div>
            <div class="lane-number">2</div>
        </div>
        <div class="lane" id="lane2">
            <img src="images/off.png" alt="Cycling Image">
            <div class="dropdown">
                <select onchange="changeFunction(this.value, 'lane2')">
                    <option value="off" selected>Off</option>
                    <option value="unknown">Unknown</option>
                    <option value="unknown2">Unknown</option>
                    <option value="operational">Operational</option>
                    <option value="yellowblinking">Yellow Blinking</option>
                </select>
            </div>
            <div class="lane-number">1</div>
        </div>
        <div class="lane" id="lane3">
            <img src="images/off.png" alt="Cycling Image">
            <div class="dropdown">
                <select onchange="changeFunction(this.value, 'lane3')">
                    <option value="off" selected>Off</option>
                    <option value="unknown">Unknown</option>
                    <option value="unknown2">Unknown</option>
                    <option value="operational">Operational</option>
                    <option value="yellowblinking">Yellow Blinking</option>
                </select>
            </div>
            <div class="lane-number">0</div>
        </div>
    </div>

    <div id="controls">
        <label for="delayInput" style="color: white;">Yellow time (seconds):</label>
        <input type="number" id="delayInput" value="1" min="0.1" step="0.1">
        <button onclick="applyYellowDelay()">Apply</button>
        <br>
        <label for="operationalDelayInput" style="color: white;">Operational time (seconds):</label>
        <input type="number" id="operationalDelayInput" value="3" min="0.1" step="0.1">
        <button onclick="applyOperationalDelay()">Apply</button>
        <br>
        <span style="color: white; margin-left: 10px;">Switch State</span>
        <label for="stateSwitch" class="toggle-switch">
            <input type="checkbox" id="stateSwitch" onchange="toggleState()">
            <span class="toggle-slider"></span>
        </label>
        <br>
        <label style="color: white;">Switch all lanes:</label>
        <div class="dropdown">
            <select onchange="changeAllLanes(this.value)">
                <option value="off">Off</option>
                <option value="unknown">Unknown</option>
                <option value="unknown2">Unknown</option>
                <option value="operational">Operational</option>
                <option value="yellowblinking">Yellow Blinking</option>
            </select>
        </div>

    </div>

    <script>
        const cycleImagesYellowBlinking = [
            "images/yellow.png",
            "images/off.png"
        ];

        const cycleImagesOperational = [
            "images/yellow.png",
            "images/red.png",
            "images/green.png"
        ];

        const imageOff = "images/off.png";
        const imageUnknown = "images/unknown.png";
        const imageUnknown2 = "images/unknown2.png";

        let delayInSeconds = 1;
        let operationalDelayInSeconds = 3;
        let timeouts = { lane1: [], lane2: [], lane3: [] };

        function clearAllTimeouts() {
            Object.keys(timeouts).forEach(key => {
                timeouts[key].forEach(timeout => clearTimeout(timeout));
                timeouts[key] = [];
            });
        }

        function clearTimeoutsForLane(laneId) {
            timeouts[laneId].forEach(timeout => clearTimeout(timeout));
            timeouts[laneId] = [];
        }

        function yellowBlinking(element, laneId) {
            element.src = cycleImagesYellowBlinking[0];
            timeouts[laneId].push(setTimeout(() => yellowBlinkingHelper(element, laneId), delayInSeconds * 1000));
        }

        function yellowBlinkingHelper(element, laneId) {
            element.src = cycleImagesYellowBlinking[1];
            timeouts[laneId].push(setTimeout(() => yellowBlinking(element, laneId), delayInSeconds * 1000));
        }

        function operational(element, laneId) {
            element.src = cycleImagesOperational[0];
            timeouts[laneId].push(setTimeout(() => operationalHelper(element, 1, laneId), operationalDelayInSeconds * 1000));
        }

        function operationalHelper(element, index, laneId) {
            if (index >= cycleImagesOperational.length) {
                index = 0;
            }
            element.src = cycleImagesOperational[index];
            timeouts[laneId].push(setTimeout(() => operationalHelper(element, index + 1, laneId), operationalDelayInSeconds * 1000));
        }

        function off(element, laneId) {
            element.src = imageOff;
            clearTimeoutsForLane(laneId);
        }

        function unknown(element, laneId) {
            element.src = imageUnknown;
            clearTimeoutsForLane(laneId);
        }

        function unknown2(element, laneId) {
            element.src = imageUnknown2;
            clearTimeoutsForLane(laneId);
        }

        function changeFunction(value, elementId) {
            const element = document.getElementById(elementId).getElementsByTagName('img')[0];
            const laneId = elementId.toLowerCase();
            clearTimeoutsForLane(laneId);
            switch (value) {
                case 'unknown':
                    unknown(element, laneId);
                    break;
                case 'off':
                    off(element, laneId);
                    break;
                case 'operational':
                    operational(element, laneId);
                    break;
                case 'yellowblinking':
                    yellowBlinking(element, laneId);
                    break;
                case 'unknown2':
                    unknown2(element, laneId);
                    break;
                default:
                    console.error('Invalid option');
            }
        }

        function applyYellowDelay() {
            const delayInput = document.getElementById('delayInput');
            delayInSeconds = parseFloat(delayInput.value);
            console.log('New delay:', delayInSeconds);
        }

        function applyOperationalDelay() {
            const operationalDelayInput = document.getElementById('operationalDelayInput');
            operationalDelayInSeconds = parseFloat(operationalDelayInput.value);
            console.log('New operational delay:', operationalDelayInSeconds);
        }

        let isOperationalState = true; // Initial state is "Operational"

        function toggleState() {
            clearAllTimeouts();

            const stateSwitch = document.getElementById('stateSwitch');
            const dropdownOptions = stateSwitch.checked ? ['off', 'unknown', 'unknown2', 'yellowblinking'] : ['off', 'unknown', 'unknown2', 'operational'];

            // Update dropdown values for all lanes
            ['lane1', 'lane2', 'lane3'].forEach(laneId => {
                const dropdown = document.getElementById(laneId).getElementsByTagName('select')[0];
                updateDropdownOptions(dropdown, dropdownOptions);
            });

            if (isOperationalState) {
                // Switching to Blinking Yellow
                changeFunction('off', 'lane1'); // Lane 2 off
                changeFunction('off', 'lane3'); // Lane 0 off
                changeFunction('yellowblinking', 'lane2'); // Lane 1 blinking yellow
            } else {
                // Switching to Operational
                changeFunction('operational', 'lane1'); // Lane 1 operational
                changeFunction('operational', 'lane2'); // Lane 2 operational
                changeFunction('operational', 'lane3'); // Lane 0 operational
            }

            isOperationalState = !isOperationalState; // Toggle the state
        }

        function updateDropdownOptions(dropdown, options) {
            // Remove existing options
            dropdown.innerHTML = '';

            // Add new options
            options.forEach(optionValue => {
                const option = document.createElement('option');
                option.value = optionValue;
                option.text = optionValue.charAt(0).toUpperCase() + optionValue.slice(1);
                dropdown.add(option);
            });
        }

        function changeAllLanes(value) {
            changeFunction(value, 'lane1');
            changeFunction(value, 'lane2');
            changeFunction(value, 'lane3');
        }
    </script>
</body>

</html>